<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Gestor de Stock GTA Hub</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background-color: #f4f4f4; }
    h2 { margin-top: 30px; }
    .section { margin-bottom: 20px; }
    input, select, button { margin: 5px; padding: 5px; }
    .property-btn { margin: 3px; }
    .tab-btn { margin-right: 5px; }
  </style>
</head>
<body>

  <h1>Gestor de Stock - GTA Hub</h1>

  <div class="section">
    <input type="text" id="newPropertyName" placeholder="Nombre de propiedad" />
    <button onclick="crearPropiedad()">Crear propiedad</button>
  </div>

  <div id="propertiesList" class="section"></div>

  <div id="propertyPanel" class="section" style="display:none;">
    <h2 id="selectedProperty"></h2>
    <div>
      <button class="tab-btn" onclick="showTab('Objetos')">Objetos</button>
      <button class="tab-btn" onclick="showTab('Armas')">Armas</button>
      <button class="tab-btn" onclick="showTab('Drogas')">Drogas</button>
      <button class="tab-btn" onclick="showTab('Cargadores')">Cargadores</button>
    </div>
    <div id="tabContent" class="section"></div>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAK0n1tFu5oAsijJ4avndm1H_lODihueYI",
      authDomain: "pagina-web-c981b.firebaseapp.com",
      databaseURL: "https://pagina-web-c981b-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "pagina-web-c981b",
      storageBucket: "pagina-web-c981b.appspot.com",
      messagingSenderId: "784493759098",
      appId: "1:784493759098:web:bd3cb84e37e48a054e49c3",
      measurementId: "G-MMYEZ1Q17B"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    let propiedadActual = "";
    let categoriaActual = "";

    function crearPropiedad() {
      const nombre = document.getElementById('newPropertyName').value.trim();
      if (nombre === "") return alert("Ponle nombre a la propiedad.");

      const propiedadRef = ref(db, 'propiedades/' + nombre);
      set(propiedadRef, {
        nombre: nombre,
        stock: {}
      }).then(() => {
        alert("Propiedad creada.");
        document.getElementById('newPropertyName').value = "";
        cargarPropiedades();
      });
    }

    function cargarPropiedades() {
      const listDiv = document.getElementById('propertiesList');
      listDiv.innerHTML = "";

      get(ref(db, 'propiedades')).then((snapshot) => {
        if (snapshot.exists()) {
          const datos = snapshot.val();
          for (const nombre in datos) {
            const btn = document.createElement('button');
            btn.textContent = nombre;
            btn.className = 'property-btn';
            btn.onclick = () => abrirPropiedad(nombre);
            listDiv.appendChild(btn);
          }
        }
      });
    }

    function abrirPropiedad(nombre) {
      propiedadActual = nombre;
      document.getElementById('selectedProperty').textContent = `Propiedad: ${nombre}`;
      document.getElementById('propertyPanel').style.display = 'block';
      document.getElementById('tabContent').innerHTML = '';
    }

    function showTab(categoria) {
      if (!propiedadActual) return;

      categoriaActual = categoria;
      const content = `
        <h3>${categoria}</h3>
        <input type="text" id="itemName" placeholder="Nombre del ${categoria}" />
        <input type="number" id="itemQuantity" placeholder="Cantidad" />
        <button onclick="agregarItem()">Agregar</button>
      `;
      document.getElementById('tabContent').innerHTML = content;
    }

    function agregarItem() {
      const nombreItem = document.getElementById('itemName').value.trim();
      const cantidad = parseInt(document.getElementById('itemQuantity').value);

      if (nombreItem === "" || isNaN(cantidad)) {
        return alert("Completa bien los campos.");
      }

      const itemRef = ref(db, `propiedades/${propiedadActual}/stock/${categoriaActual}/${nombreItem}`);
      set(itemRef, {
        cantidad: cantidad
      }).then(() => {
        alert(`${nombreItem} a√±adido a ${categoriaActual}`);
        document.getElementById('itemName').value = "";
        document.getElementById('itemQuantity').value = "";
      });
    }

    // Cargar propiedades al iniciar
    cargarPropiedades();

  </script>
</body>
</html>

